<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>íšŒì‚¬ ê²½ì˜ ì‹œë®¬ë ˆì´ì…˜</title>
    <style>
        :root { 
            --bg: #f8f9fa; --card: #ffffff; --primary: #ffb7b2; --secondary: #b2e2f2;
            --accent: #b2b2e6; --point: #b2f2bb; --text: #4a4a4a; --danger: #ff9aa2;
            --fired: #ececec; --sidebar: #ffffff;
        }
        * { box-sizing: border-box; font-family: 'Pretendard', -apple-system, sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* ìƒë‹¨ ë°” */
        .header { background: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--primary); box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .finance-bar { background: #fff; padding: 10px 20px; font-size: 0.9rem; display: flex; justify-content: space-around; border-bottom: 1px solid #eee; font-weight: bold; }
        
        /* ë„¤ë¹„ê²Œì´ì…˜ */
        .nav { display: flex; background: white; padding: 5px; gap: 5px; border-bottom: 1px solid #eee; }
        .nav button { flex: 1; padding: 12px; border: none; background: none; border-radius: 10px; font-weight: bold; color: #bbb; cursor: pointer; transition: 0.3s; }
        .nav button.active { background: var(--primary); color: white; }

        .main-container { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        @media (min-width: 1024px) { .main-container { flex-direction: row; } }
        
        /* ì½˜í…ì¸  ì˜ì—­ */
        .content { flex: 1; padding: 15px; overflow-y: auto; position: relative; }
        .page { display: none; } .page.active { display: block; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        
        /* ì¹´ë“œ ë””ìì¸ */
        .card { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid #efefef; position: relative; transition: 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        .card.fired { background: var(--fired) !important; color: #999; filter: grayscale(1); border: 1px dashed #ccc; }
        .card:not(.fired):hover { transform: translateY(-3px); box-shadow: 0 8px 15px rgba(0,0,0,0.05); }
        
        .name-input { border: 1px solid transparent; background: #f9f9f9; font-weight: 800; font-size: 1.1rem; width: 100%; padding: 8px; border-radius: 8px; margin: 8px 0; outline: none; }
        .name-input:hover { border-color: var(--secondary); }
        .badge { font-size: 0.7rem; padding: 3px 8px; border-radius: 5px; font-weight: bold; margin-right: 5px; color: white; }

        /* ìŠ¤íƒ¯ ë””ìì¸ */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .stat-row { font-size: 0.75rem; color: #777; font-weight: 600; }
        .bar-bg { width: 100%; height: 6px; background: #eee; border-radius: 10px; overflow: hidden; margin-top: 4px; }
        .bar-fill { height: 100%; transition: 0.5s ease-in-out; }

        /* ë¡œê·¸ ë””ìì¸ */
        .log-area { background: var(--sidebar); display: flex; flex-direction: column; width: 100%; height: 40%; border-top: 2px solid #eee; }
        @media (min-width: 1024px) { .log-area { width: 380px; height: auto; border-top: none; border-left: 1px solid #eee; } }
        
        .log-header { padding: 15px; font-weight: bold; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .log-list { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 8px; }
        .log-item { padding: 10px 15px; border-radius: 12px; font-size: 0.85rem; line-height: 1.4; background: #fcfcfc; border: 1px solid #f0f0f0; }
        .log-good { background: #e8f8f0; color: #2ecc71; }
        .log-bad { background: #fdf2f2; color: #e74c3c; }
        .log-event { background: #f3f0ff; color: #8e44ad; font-weight: bold; }

        /* ëª¨ë‹¬ */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 2000; backdrop-filter: blur(3px); }
        .modal { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 25px; border-radius: 25px; width: 90%; max-width: 400px; box-shadow: 0 20px 40px rgba(0,0,0,0.15); }

        .btn { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; margin-top: 8px; }
        .btn-p { background: var(--primary); color: white; }
        .btn-s { background: var(--secondary); color: white; }
        select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #eee; margin: 5px 0 15px 0; background: #fafafa; }
    </style>
</head>
<body>

<div class="header">
    <h2 style="margin:0; font-size:1.1rem; color:var(--text)">ğŸ“ íšŒì‚¬ ê²½ì˜ ì‹œë®¬ë ˆì´ì…˜</h2>
    <div style="display:flex; gap:8px;">
        <button onclick="nextDay()" class="btn" style="margin:0; width:auto; padding:8px 15px; background:var(--secondary); color:white;">ë‹¤ìŒë‚ </button>
        <button id="autoBtn" onclick="toggleAuto()" class="btn" style="margin:0; width:auto; padding:8px 15px; background:var(--primary); color:white;">ìë™</button>
    </div>
</div>

<div class="finance-bar">
    <span id="mDisp">ğŸ’° 1,000,000</span>
    <span id="dDisp">ğŸ“… Day 1</span>
    <span id="cDisp">ğŸ‘¥ 0ëª…</span>
</div>

<div class="nav">
    <button id="n-emp" class="active" onclick="tab('emp')">ì¸ì‚¬ì •ë³´</button>
    <button id="n-rel" onclick="tab('rel')">ê´€ê³„/ë™í˜¸íšŒ</button>
    <button id="n-sys" onclick="tab('sys')">ì‹œìŠ¤í…œ</button>
</div>

<div class="main-container">
    <div class="content">
        <div id="p-emp" class="page active">
            <div id="eGrid" class="grid"></div>
            <div id="emptyMsg" style="text-align:center; padding:80px 0; color:#ccc;">ì‚¬ì›ì„ ì±„ìš©í•˜ì—¬ íšŒì‚¬ë¥¼ ì‹œì‘í•˜ì„¸ìš”.</div>
            <button onclick="hire()" class="btn btn-p" style="margin:20px auto; width:200px; display:block;">+ ì‚¬ì› ì±„ìš©</button>
        </div>

        <div id="p-rel" class="page">
            <h4 style="margin-top:0;">ğŸ¤ ì‚¬ë‚´ ê´€ê³„ë§</h4>
            <div id="rList"></div>
            <h4 style="margin-top:25px;">ğŸ­ ë™í˜¸íšŒ í˜„í™©</h4>
            <div id="cList"></div>
        </div>

        <div id="p-sys" class="page">
            <div style="background:white; padding:20px; border-radius:20px; border:1px solid #eee; margin-bottom:15px;">
                <h4 style="margin:0 0 10px 0;">ğŸ¦ ê¸ˆìœµ ì„¼í„°</h4>
                <button onclick="takeLoan()" class="btn btn-s">ê¸´ê¸‰ ëŒ€ì¶œ (200ë§Œ)</button>
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <button onclick="exportData('HR')" class="btn" style="background:#ddd;">HR ì¶”ì¶œ</button>
                <button onclick="exportData('BIZ')" class="btn" style="background:#ddd;">BIZ ì¶”ì¶œ</button>
            </div>
            <button onclick="confirm('ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?') && location.reload()" class="btn" style="background:#ff9aa2; color:white; margin-top:20px;">ì‹œìŠ¤í…œ ì „ì²´ ì´ˆê¸°í™”</button>
        </div>
    </div>

    <div class="log-area">
        <div class="log-header">
            <span>ğŸ“‹ ì‹¤ì‹œê°„ ì—…ë¬´ ë¡œê·¸</span>
            <label style="font-size:0.7rem; font-weight:normal;"><input type="checkbox" id="autoScroll" checked> ìë™ìŠ¤í¬ë¡¤</label>
        </div>
        <div id="lBox" class="log-list"></div>
    </div>
</div>

<div id="mOv" class="modal-overlay" onclick="clM()"><div class="modal" onclick="event.stopPropagation()">
    <h3 id="mTitle" style="margin:0 0 15px 0;">ì¸ì‚¬ ì¹´ë“œ ìˆ˜ì •</h3>
    <label style="font-size:0.75rem;">ì´ë¦„ ê°œëª…</label>
    <input type="text" id="editName" class="name-input" oninput="rename(this.value)">

    <div style="background:#f9f9f9; padding:15px; border-radius:15px; margin:15px 0;">
        <strong style="font-size:0.8rem; color:var(--accent);">ğŸ”— ê´€ê³„ ê°•ì œ ì„¤ì •</strong>
        <select id="relTarget"></select>
        <select id="relType">
            <option value="ë² í”„">ë² í”„</option><option value="ë¼ì´ë²Œ">ë¼ì´ë²Œ</option>
            <option value="ë¹„ë°€ì—°ì• ">ë¹„ë°€ì—°ì• </option><option value="ë¶ˆë¥œ">ë¶ˆë¥œ</option>
            <option value="í˜ê´€">í˜ê´€</option><option value="ìŠ¤ìŠ¹">ìŠ¤ìŠ¹</option>
            <option value="ì•™ìˆ™">ì•™ìˆ™</option><option value="ë™ê²½">ë™ê²½</option>
            <option value="ì†Œì›í•¨">ì†Œì›í•¨</option>
        </select>
        <button onclick="setRel()" class="btn btn-s" style="padding:10px; font-size:0.8rem;">ê´€ê³„ ì ìš©</button>
    </div>

    <div style="background:#fff2f2; padding:15px; border-radius:15px;">
        <strong style="font-size:0.8rem; color:var(--danger);">âš”ï¸ ìŠ¹ì§„ ë°°í‹€ ë§¤ì¹­</strong>
        <select id="btlTarget"></select>
        <button onclick="battle()" class="btn" style="background:var(--danger); color:white; padding:10px; font-size:0.8rem;">ë„ì „ ì‹œì‘</button>
    </div>

    <div style="display:flex; gap:10px; margin-top:15px;">
        <button onclick="fire()" class="btn" style="background:#eee; margin:0;">í•´ê³ </button>
        <button onclick="clM()" class="btn btn-p" style="margin:0;">ë‹«ê¸°</button>
    </div>
</div></div>

<script>
    // ë°ì´í„° ë° ìƒìˆ˜
    let st = { m: 1000000, d: 1, e: [], r: {}, loan: 0 };
    const RANKS = ["ì¸í„´", "ì‚¬ì›", "ëŒ€ë¦¬", "ê³¼ì¥", "ì°¨ì¥", "ë¶€ì¥", "ì´ì‚¬", "CEO"];
    const SALARY = [2200, 3800, 6500, 11000, 18000, 35000, 60000, 120000];
    const TRAITS = ["ì²œì¬", "ì›Œì»¤í™€ë¦­", "ì‚¬êµê°€", "ê²Œìœ¼ë¦„", "ì•¼ì‹¬ê°€", "íŠ¸ëŸ¬ë¸”ë©”ì´ì»¤", "ë‚™ì²œì "];
    const CLUBS = ["í…Œë‹ˆìŠ¤í´ëŸ½", "ì™€ì¸ë™ì•„ë¦¬", "ì½”ë”©ì—°êµ¬íšŒ", "ë“±ì‚°íšŒ", "ë’·ë‹´í™”íŒŒí‹°"];
    const L_NAMES = ["ê¹€", "ì´", "ë°•", "ìµœ", "ì •", "ê°•", "ì¡°", "ìœ¤", "ì¥", "ì„"];
    const F_NAMES = ["ì„œì¤€", "í•˜ìœ¤", "ë„ìœ¤", "ì§€ìš°", "ì‹œìš°", "ë¯¼ì„œ", "ì£¼ì›", "ì±„ì›", "ì˜ˆì¤€", "ì„œì•„"];
    
    // 50ê°€ì§€ í–‰ë™ ë¡œì§
    const ACTIONS = [
        "í˜ì‹ ì ì¸ ê¸°íšì•ˆì„ ì œì¶œí•©ë‹ˆë‹¤", "ëª°ë˜ íƒ•ë¹„ì‹¤ ê°„ì‹ì„ ì±™ê¹ë‹ˆë‹¤", "ì£¼ì‹ ì°½ì„ ë³´ë‹¤ í•œìˆ¨ì„ ì‰½ë‹ˆë‹¤", "ì—…ë¬´ ì¤‘ ëª°ë˜ ì‡¼í•‘ì„ í•©ë‹ˆë‹¤",
        "ì»¤í”¼ë¥¼ ì‚¬ëŸ¬ ë‚˜ê°”ë‹¤ 1ì‹œê°„ ë’¤ì— ì˜µë‹ˆë‹¤", "ìƒì‚¬ ìš•ì„ í•˜ë‹¤ê°€ ë”± ê±¸ë¦½ë‹ˆë‹¤", "ë³µì‚¬ê¸°ë¥¼ ê³ ì¥ë‚´ê³  ë„ë§ê°‘ë‹ˆë‹¤", "ì¡¸ìŒê³¼ ì‚¬íˆ¬ë¥¼ ë²Œì…ë‹ˆë‹¤",
        "ë³´ê³ ì„œë¥¼ ì±—GPTë¡œ ëŒ€ì¶© ë½‘ìŠµë‹ˆë‹¤", "ë™ë£Œì˜ ì‹¤ìˆ˜ì— ëª°ë˜ ì›ƒìŒ ì§“ìŠµë‹ˆë‹¤", "ì´ì‚¬ë‹˜ê»˜ ì˜í˜¼ ì—†ëŠ” ì•„ë¶€ë¥¼ í•©ë‹ˆë‹¤", "ë²•ì¹´ë¡œ ë¹„ì‹¼ ì ì‹¬ì„ ë¨¹ìŠµë‹ˆë‹¤",
        "ìê¸°ê³„ë°œì„œë¥¼ ì½ëŠ” ì²™í•˜ë©° ì›¹íˆ°ì„ ë´…ë‹ˆë‹¤", "ì„œë¥˜ ë­‰ì¹˜ë¥¼ ë°œë“±ì— ë–¨ì–´ëœ¨ë¦½ë‹ˆë‹¤", "í‡´ê·¼ ì‹œê°„ë§Œ ì´ˆì¡°í•˜ê²Œ ê¸°ë‹¤ë¦½ë‹ˆë‹¤", "í™”ì¥ì‹¤ì—ì„œ ìŠ¤ë§ˆíŠ¸í° ê²Œì„ì„ í•©ë‹ˆë‹¤",
        "ë¶ˆë¥œ ì†Œë¬¸ì„ ë“£ê³  ëˆˆì´ ì»¤ì§‘ë‹ˆë‹¤", "ë™ë£Œì—ê²Œ ê³ ë°±í• ê¹Œ ê³ ë¯¼ ì¤‘ì…ë‹ˆë‹¤", "íšŒì‚¬ ì—ì–´ì»¨ ì˜¨ë„ë¡œ ì‹¸ì›ë‹ˆë‹¤", "ì›”ê¸‰ ë£¨íŒ¡ì§ˆì— ì„±ê³µí•©ë‹ˆë‹¤"
    ];

    let selId = null, timer = null;

    // ì±„ìš© ë¡œì§
    function hire() {
        let name = prompt("ìƒˆ ì‚¬ì›ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ì·¨ì†Œ ì‹œ ëœë¤)", "");
        if(name === null) return;
        const finalName = name.trim() || L_NAMES[Math.floor(Math.random()*10)] + F_NAMES[Math.floor(Math.random()*10)];
        
        const id = Date.now() + Math.random();
        st.e.push({
            id, n: finalName, rIdx: 0, trait: TRAITS[Math.floor(Math.random()*TRAITS.length)],
            club: Math.random() < 0.3 ? CLUBS[Math.floor(Math.random()*CLUBS.length)] : null,
            fired: false, tech: 30+Math.random()*60, sale: 30+Math.random()*60, mtl: 40+Math.random()*50, hp: 100
        });
        document.getElementById('emptyMsg').style.display = 'none';
        addLog(`ğŸŒ¸ <b>${finalName}</b>ë‹˜ì´ ì…ì‚¬í–ˆìŠµë‹ˆë‹¤!`, "log-good");
        update();
    }

    // ì‹œê°„ ì§„í–‰ ë¡œì§
    function nextDay() {
        st.d++;
        let dailyRev = 0; let dailyExp = 0;
        
        st.e.forEach(e => {
            if(e.fired) return;
            dailyRev += (e.tech * 10) + (e.sale * 12);
            dailyExp += SALARY[e.rIdx];
            
            // ì‹¤ì‹œê°„ í–‰ë™
            if(Math.random() < 0.2) {
                const act = ACTIONS[Math.floor(Math.random()*ACTIONS.length)];
                addLog(`âœ¨ <b>${e.n}</b>ë‹˜ì´ ${act}.`);
                
                // ìë™ ê´€ê³„ í˜•ì„±
                const others = st.e.filter(o => o.id !== e.id && !o.fired);
                if(others.length > 0 && Math.random() < 0.05) {
                    const target = others[Math.floor(Math.random()*others.length)];
                    autoRel(e.id, target.id);
                }
            }
        });

        st.m += (dailyRev - dailyExp);
        if(st.loan > 0) st.m -= (st.loan * 0.05); // ì´ì

        // ìë™ í•´ê³  (ì„±ê³¼ ë‚®ì€ ìˆœ)
        if(st.m < 0) {
            const targets = st.e.filter(e => !e.fired).sort((a,b) => (a.tech+a.sale)-(b.tech+b.sale));
            if(targets[0]) {
                targets[0].fired = true;
                addLog(`ğŸš¨ ìê¸ˆ ë¶€ì¡±ìœ¼ë¡œ <b>${targets[0].n}</b>ë‹˜ì´ í•´ê³  ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`, "log-bad");
            }
        }

        if(Math.random() < 0.1) randomEvent();
        update();
    }

    function autoRel(id1, id2) {
        const key = [id1, id2].sort().join('-');
        if(!st.r[key]) {
            const types = ["ë² í”„", "ë¼ì´ë²Œ", "ì§ì‚¬ë‘", "í˜ê´€", "ë¹„ë°€ì—°ì• ", "ë¶ˆë¥œ"];
            const t = types[Math.floor(Math.random()*types.length)];
            st.r[key] = t;
            if(t === "ë¶ˆë¥œ" || t === "ë¹„ë°€ì—°ì• ") addLog(`ğŸ”¥ [ì†Œë¬¸] <b>${getN(id1)}</b>ì™€ <b>${getN(id2)}</b>ì˜ ê¸°ë¥˜ê°€ ì‹¬ìƒì¹˜ ì•ŠìŠµë‹ˆë‹¤!`, "log-bad");
        }
    }

    function randomEvent() {
        const evs = [
            {n: "ğŸŒˆ ì—”ì ¤ íˆ¬ì ìœ ì¹˜ ì„±ê³µ!", m: 2500000, c: "log-event"},
            {n: "ğŸ’§ ì„œë²„ ë§ˆë¹„ë¡œ ë³µêµ¬ë¹„ìš© ë°œìƒ!", m: -1000000, c: "log-bad"},
            {n: "ğŸ­ ì‚¬ë‚´ ë¶ˆë¥œ ìŠ¤ìº”ë“¤ì´ ê¸°ì‚¬í™”!", m: -500000, c: "log-bad"},
            {n: "ğŸ“ˆ ì‹ ì œí’ˆ ëŒ€ë°• íˆ¬ì ìˆ˜ìµ!", m: 3000000, c: "log-event"}
        ];
        const ev = evs[Math.floor(Math.random()*evs.length)];
        st.m += ev.m; addLog(`ğŸ“¢ ${ev.n}`, ev.c);
    }

    // UI ë° í¸ì˜ ê¸°ëŠ¥
    function update() {
        document.getElementById('mDisp').innerText = `ğŸ’° ${Math.floor(st.m).toLocaleString()}`;
        document.getElementById('dDisp').innerText = `ğŸ“… Day ${st.d}`;
        document.getElementById('cDisp').innerText = `ğŸ‘¥ ${st.e.filter(e=>!e.fired).length}ëª…`;
        
        const grid = document.getElementById('eGrid');
        grid.innerHTML = st.e.map(e => `
            <div class="card ${e.fired?'fired':''}" onclick="opM(${e.id})">
                <span class="badge" style="background:var(--accent)">${RANKS[e.rIdx]}</span>
                <span class="badge" style="background:#888">#${e.trait}</span>
                <input class="name-input" value="${e.n}" oninput="selId=${e.id}; rename(this.value)" onclick="event.stopPropagation()">
                <div style="font-size:0.7rem; color:#aaa; margin-bottom:10px;">ğŸ  ${e.club || 'ë™í˜¸íšŒ ì—†ìŒ'}</div>
                <div class="stat-grid">
                    ${drawBar('ğŸ› ï¸ ê¸°ìˆ ', e.tech, 'var(--primary)')}
                    ${drawBar('ğŸ¤ ì˜ì—…', e.sale, 'var(--secondary)')}
                    ${drawBar('ğŸ§  ë©˜íƒˆ', e.mtl, 'var(--accent)')}
                    ${drawBar('â¤ï¸ ì²´ë ¥', e.hp, 'var(--point)')}
                </div>
            </div>
        `).join('');

        let rH = "";
        for(let k in st.r) {
            const [i1, i2] = k.split('-');
            const e1 = st.e.find(x=>x.id==i1), e2 = st.e.find(x=>x.id==i2);
            if(e1 && e2 && !e1.fired && !e2.fired) {
                rH += `<div style="padding:10px; border-bottom:1px solid #eee; font-size:0.85rem;"><b>${e1.n}</b> â†”ï¸ <b>${e2.n}</b> : <span style="color:var(--danger)">${st.r[k]}</span></div>`;
            }
        }
        document.getElementById('rList').innerHTML = rH || "ê´€ê³„ ë°ì´í„° ì—†ìŒ";

        document.getElementById('cList').innerHTML = CLUBS.map(c => {
            const mems = st.e.filter(e => e.club === c && !e.fired).map(e => e.n);
            return mems.length > 0 ? `<div style="font-size:0.85rem; margin-bottom:5px;"><b>${c}:</b> ${mems.join(', ')}</div>` : '';
        }).join('');
    }

    function drawBar(l, v, c) { return `<div class="stat-row">${l}<div class="bar-bg"><div class="bar-fill" style="width:${Math.min(v,100)}%; background:${c}"></div></div></div>`; }
    function addLog(m, c="") {
        const box = document.getElementById('lBox');
        const div = document.createElement('div'); div.className = `log-item ${c}`;
        div.innerHTML = `<small>Day ${st.d}</small><br>${m}`;
        box.appendChild(div);
        if(document.getElementById('autoScroll').checked) box.scrollTop = box.scrollHeight;
    }
    function opM(id) {
        const e = st.e.find(x => x.id === id); if(!e || e.fired) return;
        selId = id; document.getElementById('editName').value = e.n;
        const others = st.e.filter(o => o.id !== id && !o.fired);
        document.getElementById('relTarget').innerHTML = others.map(o => `<option value="${o.id}">${o.n}</option>`).join('');
        document.getElementById('btlTarget').innerHTML = others.map(o => `<option value="${o.id}">${o.n}</option>`).join('');
        document.getElementById('mOv').style.display = 'block';
    }
    function rename(v) { const e = st.e.find(x=>x.id===selId); if(e) { e.n = v; update(); } }
    function setRel() {
        const tId = document.getElementById('relTarget').value;
        const type = document.getElementById('relType').value;
        if(tId) { st.r[[selId, tId].sort().join('-')] = type; clM(); update(); }
    }
    function battle() {
        const p1 = st.e.find(x=>x.id===selId); const p2 = st.e.find(x=>x.id==document.getElementById('btlTarget').value);
        if(p1.tech + Math.random()*40 > p2.tech + Math.random()*40) {
            p1.rIdx = Math.min(7, p1.rIdx + 1); p2.rIdx = Math.max(0, p2.rIdx - 1);
            addLog(`âš”ï¸ <b>${p1.n}</b> ìŠ¹ë¦¬! ìŠ¹ì§„í–ˆìŠµë‹ˆë‹¤.`, "log-event");
        } else { addLog(`âš”ï¸ <b>${p1.n}</b> íŒ¨ë°°! í•˜ê·¹ìƒ ì‹¤íŒ¨.`, "log-bad"); }
        clM(); update();
    }
    function fire() { const e = st.e.find(x=>x.id===selId); if(e) { e.fired = true; addLog(`âš ï¸ <b>${e.n}</b>ë‹˜ì´ íšŒìƒ‰ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`, "log-bad"); clM(); update(); } }
    function clM() { document.getElementById('mOv').style.display = 'none'; }
    function tab(t) { document.querySelectorAll('.page, .nav button').forEach(x => x.classList.remove('active')); document.getElementById(`p-${t}`).classList.add('active'); document.getElementById(`n-${t}`).classList.add('active'); }
    function toggleAuto() { if(timer) { clearInterval(timer); timer = null; document.getElementById('autoBtn').innerText="ìë™"; } else { timer = setInterval(nextDay, 1200); document.getElementById('autoBtn').innerText="ì¤‘ì§€"; } }
    function takeLoan() { st.m += 2000000; st.loan += 2000000; addLog("ğŸ¦ ëŒ€ì¶œê¸ˆ 200ë§Œ ì›ì´ ì…ê¸ˆë˜ì—ˆìŠµë‹ˆë‹¤. ë§¤ì¼ ì´ìê°€ ë‚˜ê°‘ë‹ˆë‹¤."); update(); }
    function exportData(t) {
        const d = t==='HR'?st.e:st; const blob = new Blob([JSON.stringify(d, null, 2)], {type:'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `${t}_DATA.json`; a.click();
    }
    function getN(id) { const e = st.e.find(x=>x.id==id); return e ? e.n : "ëˆ„êµ°ê°€"; }

    update();
</script>
</body>
</html>
