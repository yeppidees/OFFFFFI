<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>íšŒì‚¬ ê²½ì˜ ì‹œë®¬ë ˆì´ì…˜</title>
    <style>
        :root { 
            --bg: #fdfaf5; /* í¸ì•ˆí•œ ì›œ í™”ì´íŠ¸ */
            --card: #ffffff;
            --primary: #ffb7b2; /* íŒŒìŠ¤í…” í•‘í¬ */
            --secondary: #b2e2f2; /* íŒŒìŠ¤í…” ë¸”ë£¨ */
            --accent: #b2b2e6; /* íŒŒìŠ¤í…” í¼í”Œ */
            --point: #b2f2bb; /* íŒŒìŠ¤í…” ê·¸ë¦° */
            --text: #5d5d5d; /* ì§„í•œ íšŒìƒ‰ (ëˆˆ ë³´í˜¸) */
            --danger: #ff9aa2; /* ë¶€ë“œëŸ¬ìš´ ë ˆë“œ */
            --fired: #e0e0e0; /* í•´ê³  ì‹œ íšŒìƒ‰ ì²˜ë¦¬ */
            --sidebar: #f7f3ed; /* íƒ€ì„ë¼ì¸ ë°°ê²½ */
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Pretendard', sans-serif; }
        body { background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* í—¤ë” & ëŒ€ì‹œë³´ë“œ */
        .header { background: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid var(--primary); z-index: 10; }
        .finance-bar { background: #fffdf9; padding: 12px 20px; font-size: 0.95rem; display: flex; justify-content: space-around; font-weight: bold; color: #888; border-bottom: 1px solid #f0ede8; }
        
        /* ë„¤ë¹„ê²Œì´ì…˜ */
        .nav { display: flex; background: white; padding: 5px; gap: 5px; border-bottom: 1px solid #eee; }
        .nav button { flex: 1; padding: 12px; border: none; background: none; border-radius: 12px; font-weight: bold; color: #bbb; cursor: pointer; transition: 0.3s; }
        .nav button.active { background: var(--primary); color: white; }

        .main-wrapper { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        @media (min-width: 1024px) { .main-wrapper { flex-direction: row; } }
        
        /* ë©”ì¸ ì½˜í…ì¸  */
        .content-area { flex: 1; padding: 20px; overflow-y: auto; }
        .page { display: none; } .page.active { display: block; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 18px; }
        
        /* ì‚¬ì› ì¹´ë“œ (íŒŒìŠ¤í…” í…Œë‘ë¦¬) */
        .card { background: var(--card); padding: 22px; border-radius: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.03); border: 2px solid #f0f0f0; transition: 0.3s; position: relative; overflow: hidden; }
        .card::before { content: ""; position: absolute; top: 0; left: 0; width: 6px; height: 100%; background: var(--secondary); }
        .card.fired { background: var(--fired); filter: grayscale(1); opacity: 0.6; border-color: #ddd; }
        .card.fired::before { background: #aaa; }
        .card:not(.fired):hover { transform: translateY(-5px); border-color: var(--primary); }

        .rank-label { font-size: 0.75rem; background: var(--accent); color: white; padding: 3px 10px; border-radius: 50px; font-weight: bold; }
        .name-input { border: 1px solid #f0f0f0; background: #fafafa; font-weight: 800; font-size: 1.2rem; width: 100%; padding: 10px; border-radius: 12px; margin: 12px 0; outline: none; color: var(--text); }

        /* ìŠ¤íƒ¯ */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .stat-item { font-size: 0.75rem; font-weight: bold; color: #888; }
        .bar-bg { width: 100%; height: 8px; background: #f0f0f0; border-radius: 10px; overflow: hidden; margin-top: 5px; }
        .bar-fill { height: 100%; transition: 1s ease-in-out; }

        /* âœ¨ íŒŒìŠ¤í…” íƒ€ì„ë¼ì¸ */
        .log-sidebar { background: var(--sidebar); display: flex; flex-direction: column; width: 100%; height: 40%; border-top: 3px solid #e9e0d5; }
        @media (min-width: 1024px) { .log-sidebar { width: 420px; height: auto; border-top: none; border-left: 3px solid #e9e0d5; } }
        
        .log-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        .log-item { padding: 15px; border-radius: 18px; font-size: 0.88rem; line-height: 1.6; background: white; border: 1px solid #eee; color: #666; animation: logFade 0.4s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .log-good { background: #f2faf3; border-color: var(--point); color: #5eb56d; }
        .log-bad { background: #fff5f5; border-color: var(--danger); color: #d68389; }
        .log-scandal { background: #fdf2f8; border-color: #ffb7d5; color: #d66ea3; font-weight: bold; }
        .log-time { font-size: 0.7rem; color: #bbb; margin-bottom: 5px; display: block; }

        @keyframes logFade { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        /* ê´€ê³„ ë¦¬ìŠ¤íŠ¸ */
        .rel-box { background: #fff; padding: 18px; border-radius: 20px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #f5f5f5; }

        /* ëª¨ë‹¬ (íŒŒìŠ¤í…”) */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.3); z-index: 1000; backdrop-filter: blur(4px); }
        .modal { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 35px; border-radius: 35px; width: 92%; max-width: 460px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        
        .btn { width: 100%; padding: 16px; border-radius: 18px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 1rem; transition: 0.2s; }
        .btn:active { transform: scale(0.97); }
        .btn-p { background: var(--primary); color: white; }
        .btn-s { background: var(--secondary); color: white; }
        
        select { width: 100%; padding: 14px; border-radius: 15px; border: 1px solid #eee; margin-top: 8px; background: #fafafa; color: #777; }
    </style>
</head>
<body>

<div class="header">
    <h2 style="margin:0; font-size:1.3rem; color:var(--text); letter-spacing:-1px;">â˜ï¸ <span style="color:var(--primary)">íšŒì‚¬ ê²½ì˜</span> ìŠ¤íŠœë””ì˜¤</h2>
    <div style="display:flex; gap:10px;">
        <button onclick="nextDay()" class="btn" style="margin:0; width:auto; padding:10px 18px; background:var(--secondary); color:white;">í•˜ë£¨ ì§„í–‰</button>
        <button id="autoBtn" onclick="toggleAuto()" class="btn" style="margin:0; width:auto; padding:10px 18px; background:var(--primary); color:white;">ìë™ ì‹œì‘</button>
    </div>
</div>

<div class="finance-bar">
    <span id="mDisp">ğŸ’° 1,000,000ì›</span>
    <span id="dDisp">ğŸ“… Day 1</span>
    <span id="loanTag" style="color:var(--danger); display:none;">ğŸš¨ íšŒìƒì¤‘</span>
</div>

<div class="nav">
    <button id="n-emp" class="active" onclick="tab('emp')">ìš°ë¦¬ íŒ€ì›</button>
    <button id="n-rel" onclick="tab('rel')">ê´€ê³„ & ë™í˜¸íšŒ</button>
    <button id="n-sys" onclick="tab('sys')">íšŒì‚¬ ì„¤ì •</button>
</div>

<div class="main-wrapper">
    <div class="content-area">
        <div id="p-emp" class="page active">
            <div id="eGrid" class="grid"></div>
            <div id="emptyMsg" style="text-align:center; padding:120px 0; color:#ccc;">
                ì•„ì§ íŒ€ì›ì´ ì—†ì–´ìš”.<br>ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ìƒˆë¡œìš´ ì¸ì—°ì„ ì°¾ì•„ë³´ì„¸ìš”!
            </div>
            <button onclick="hire()" class="btn btn-p" style="margin:40px auto; width:280px; display:block;">+ íŒ€ì› ëœë¤ ì±„ìš©</button>
        </div>

        <div id="p-rel" class="page">
            <h3 style="margin-top:0; color:#888;">ğŸ¤ ì‚¬ë‚´ ê´€ê³„ í˜„í™©</h3>
            <div id="rList"></div>
            <h3 style="margin-top:40px; color:#888;">ğŸŒˆ ë™í˜¸íšŒ í™œë™</h3>
            <div id="cList"></div>
        </div>

        <div id="p-sys" class="page">
            <div style="background:white; padding:30px; border-radius:30px; margin-bottom:20px; border:1px solid #f0f0f0;">
                <h4 style="margin:0; color:#888;">ğŸ¦ ì€í–‰ ëŒ€ì¶œ (íšŒìƒ ê¸°ëŠ¥)</h4>
                <p style="font-size:0.85rem; color:#bbb; margin-bottom:20px;">ìê¸ˆì´ ë¶€ì¡±í•  ë•Œ ê¸´ê¸‰ ìˆ˜í˜ˆì„ ë°›ìŠµë‹ˆë‹¤. (ì´ìœ¨ 25%)</p>
                <button onclick="takeLoan()" class="btn btn-s">ëŒ€ì¶œ ìŠ¹ì¸ ìš”ì²­</button>
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                <button onclick="saveData('HR')" class="btn" style="background:#e9e0d5; color:#8a8279;">HR ì¶”ì¶œ</button>
                <button onclick="saveData('BIZ')" class="btn" style="background:#e9e0d5; color:#8a8279;">BIZ ì¶”ì¶œ</button>
            </div>
            <button onclick="location.reload()" class="btn" style="background:#f0f0f0; color:#bbb; margin-top:30px;">íšŒì‚¬ íì—… (ì´ˆê¸°í™”)</button>
        </div>
    </div>

    <div class="log-sidebar">
        <div style="padding:18px 25px; color:#8a8279; font-weight:bold; border-bottom:1px solid #e9e0d5;">ğŸ“‹ ì˜¤ëŠ˜ì˜ ì¼ê¸°</div>
        <div id="lBox" class="log-container"></div>
    </div>
</div>

<div id="mOv" class="modal-overlay" onclick="clM()"><div class="modal" onclick="event.stopPropagation()">
    <h3 id="mTitle" style="margin:0 0 20px 0; color:var(--text); text-align:center;">í”„ë¡œí•„ ê´€ë¦¬</h3>
    <small style="color:#aaa;">ì‚¬ì› ê°œëª…</small>
    <input type="text" id="editName" class="name-input">

    <div style="background:#fdfaf5; padding:20px; border-radius:25px; margin:20px 0;">
        <strong style="font-size:0.9rem; color:#888;">ğŸª„ ì¸ì—° ë§ºì–´ì£¼ê¸°</strong><br>
        <select id="relTarget"></select>
        <select id="relType"></select>
        <button onclick="applyRel()" class="btn btn-s" style="padding:12px; font-size:0.9rem;">ê´€ê³„ ê³ ì •</button>
    </div>

    <div style="background:#fff5f5; padding:20px; border-radius:25px; margin-bottom:20px;">
        <strong style="font-size:0.9rem; color:var(--danger);">âš”ï¸ ìŠ¹ì§„ ë°°í‹€ ë§¤ì¹­</strong><br>
        <select id="btlTarget"></select>
        <button onclick="startBattle()" class="btn" style="background:var(--danger); color:white; padding:12px; font-size:0.9rem;">ë°°í‹€ ì‹œì‘</button>
    </div>

    <div style="display:flex; gap:10px;">
        <button onclick="manualFire()" class="btn" style="background:#f0f0f0; color:#aaa; margin:0;">í•´ê³ </button>
        <button onclick="clM()" class="btn" style="background:var(--accent); color:white; margin:0;">ë‹«ê¸°</button>
    </div>
</div></div>

<script>
    // [ê¸°ë³¸ ë¡œì§ ë°ì´í„° - ì´ì „ê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€í•˜ì—¬ undefined ë°©ì§€]
    let st = { m: 1000000, d: 1, e: [], r: {}, loan: 0, over: false };
    const RANKS = ["ì¸í„´", "ì‚¬ì›", "ëŒ€ë¦¬", "ê³¼ì¥", "ì°¨ì¥", "ë¶€ì¥", "ì´ì‚¬", "CEO"];
    const SALARY = [2200, 3800, 6500, 11000, 18000, 35000, 60000, 120000];
    const TRAITS = ["ì²œì¬", "ì›Œì»¤í™€ë¦­", "ì‚¬êµê°€", "ê²Œìœ¼ë¦„", "íŠ¸ëŸ¬ë¸”ë©”ì´ì»¤", "ì•¼ì‹¬ê°€"];
    const CLUBS = ["ë“±ì‚°íšŒ", "ë‚šì‹œì™•", "ì½”ë”©í´ëŸ½", "ì™€ì¸ë™í˜¸íšŒ", "ë’·ë‹´í™”íŒŒí‹°"];
    const REL_TYPES = ["ë² í”„", "ë¼ì´ë²Œ", "ë¹„ë°€ì—°ì• ", "í˜ê´€", "ì§ì‚¬ë‘", "ë¶ˆë¥œ", "ê²½ê³„", "ìŠ¤ìŠ¹", "ì•™ìˆ™"];
    const L_NAMES = ["ê¹€", "ì´", "ë°•", "ìµœ", "ì •", "ê°•", "ì¡°", "ìœ¤", "ì¥", "ì„"];
    const F_NAMES = ["ë¯¼ìˆ˜", "ì§€í˜„", "ë„ì˜", "ì„œì•„", "í•˜ì¤€", "ìœ ì§„", "ì€ìš°", "ìˆ˜ë¹ˆ", "ì˜ˆì¤€", "ë‚˜ì€"];

    const ACTIONS = [
        "ì»¤í”¼ë¥¼ í™€ì§ì´ë©° ì°½ë°–ì„ ë´…ë‹ˆë‹¤", "í˜ì‹ ì ì¸ ì½”ë“œë¥¼ í•œ ì¤„ ì¨ëƒˆìŠµë‹ˆë‹¤", "ê²Œì„í•˜ë‹¤ ìƒì‚¬ì—ê²Œ ë”± ê±¸ë ¸ë„¤ìš”", "ì£¼ì‹ ì°½ì„ ë³´ë©° í•œìˆ¨ì„ ì‰½ë‹ˆë‹¤",
        "ìƒì‚¬ ë’·ë‹´í™”ë¥¼ ë©”ì‹ ì €ë¡œ í•˜ë‹¤ ì‹¤ìˆ˜í–ˆìŠµë‹ˆë‹¤", "ë‹´ë°° íƒ€ì„ì´ ì¡°ê¸ˆ ê¸°ë„¤ìš”", "í™”ì¥ì‹¤ì—ì„œ ìŠ¤ë§ˆíŠ¸í° ì¤‘ì…ë‹ˆë‹¤", "ì—´ì‹¬íˆ ì—…ë¬´ ì¤‘ì¸ ì²™í•©ë‹ˆë‹¤",
        "ë™ë£Œì—ê²Œ ì‚¬íƒ•ì„ ê±´ë„µë‹ˆë‹¤", "íšŒì˜ ì¤‘ì— ì˜ˆìœ ê¿ˆì„ ê¾¸ê³  ìˆìŠµë‹ˆë‹¤", "ë³´ê³ ì„œë¥¼ ì•„ì£¼ ê¹”ë”í•˜ê²Œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤", "ë©‹ì§„ ê¸°íšì•ˆì„ ì œì¶œí–ˆìŠµë‹ˆë‹¤",
        "ê±°ë˜ì²˜ì™€ ì¹œì ˆí•˜ê²Œ í†µí™” ì¤‘ì…ë‹ˆë‹¤", "íƒ•ë¹„ì‹¤ ê³¼ìë¥¼ ëª°ë˜ ì±™ê²¼ìŠµë‹ˆë‹¤", "ìê¸°ê³„ë°œ ì¸ê°•ì„ ë“£ê³  ìˆìŠµë‹ˆë‹¤", "í‡´ê·¼ë§Œ ì†ê¼½ì•„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤",
        "ì„œë¥˜ë¥¼ ì •ë¦¬í•˜ë‹¤ ì‹¤ìˆ˜ë¡œ ìŸì•˜ìŠµë‹ˆë‹¤", "ì™¸ê·¼ ê°€ì„œ ì˜ˆìœ ì¹´í˜ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤", "ì—ì–´ì»¨ ë°‘ì—ì„œ ê¸°ì§€ê°œë¥¼ ì¼­ë‹ˆë‹¤", "ë³µì‚¬ê¸°ê°€ ê³ ì¥ ë‚˜ì„œ ë‹¹í™©í–ˆìŠµë‹ˆë‹¤",
        "ì‹ ì…ì‚¬ì›ì—ê²Œ ì¹œì ˆí•˜ê²Œ ì„¤ëª… ì¤‘ì…ë‹ˆë‹¤", "ë¶ˆë¥œ ì†Œë¬¸ì„ ë“£ê³  ê¹œì§ ë†€ëìŠµë‹ˆë‹¤", "ëˆ„êµ°ê°€ì—ê²Œ ê³ ë°±í• ì§€ ê³ ë¯¼ ì¤‘ì…ë‹ˆë‹¤", "ì±—GPTë¡œ ë³´ê³ ì„œë¥¼ ëšë”± ë§Œë“­ë‹ˆë‹¤"
    ];

    let selId = null, autoTimer = null;

    function hire() {
        const id = Date.now() + Math.random();
        const name = L_NAMES[Math.floor(Math.random()*10)] + F_NAMES[Math.floor(Math.random()*10)];
        const trait = TRAITS[Math.floor(Math.random()*TRAITS.length)];
        const club = Math.random() < 0.3 ? CLUBS[Math.floor(Math.random()*CLUBS.length)] : null;
        st.e.push({ id, n: name, rIdx: 0, trait, club, isFired: false, tech: 40 + Math.random()*40, sale: 40 + Math.random()*40, mtl: 50 + Math.random()*40, hp: 100 });
        document.getElementById('emptyMsg').style.display = 'none';
        log(`ğŸŒ¸ <b>${name}</b>ë‹˜ì´ ìš°ë¦¬ íšŒì‚¬ì˜ ìƒˆ ì‹êµ¬ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤!`, "log-good");
        updateUI();
    }

    function nextDay() {
        if(st.over) return; st.d++;
        let rev = 0; let exp = 0;
        st.e.forEach(e => {
            if(e.isFired) return;
            rev += (e.tech * 5.2) + (e.sale * 6.5);
            exp += SALARY[e.rIdx];
            if(Math.random() < 0.25) {
                const act = ACTIONS[Math.floor(Math.random()*ACTIONS.length)];
                let type = "";
                if(act.includes("í˜ì‹ ") || act.includes("ê¹”ë”") || act.includes("ì œì¶œ")) type = "log-good";
                if(act.includes("ê±¸ë ¸") || act.includes("ì‹¤ìˆ˜") || act.includes("ë‹¹í™©")) type = "log-bad";
                if(act.includes("ë¶ˆë¥œ") || act.includes("ê³ ë°±")) type = "log-scandal";
                log(`âœ¨ <b>${e.n}</b>ë‹˜ì´ ${act}.`, type);
                const others = st.e.filter(o => o.id !== e.id && !o.isFired);
                if(others.length > 0 && Math.random() < 0.1) autoRel(e.id, others[Math.floor(Math.random()*others.length)].id);
            }
        });
        if(st.loan > 0) exp += (st.loan * 0.01);
        st.m += (rev - exp);
        if(Math.random() < 0.15) triggerEvent();
        if(st.m < 0) {
            const targets = st.e.filter(e => !e.isFired).sort((a,b) => (a.tech+a.sale)-(b.tech+b.sale));
            if(targets[0]) { targets[0].isFired = true; log(`âš ï¸ ê²½ì˜ë‚œìœ¼ë¡œ <b>${targets[0].n}</b>ë‹˜ì´ íšŒìƒ‰ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`, "log-bad"); }
        }
        checkEndings(); updateUI();
    }

    function autoRel(id1, id2) {
        const key = [id1, id2].sort().join('-');
        if(!st.r[key]) {
            const type = REL_TYPES[Math.floor(Math.random()*REL_TYPES.length)];
            st.r[key] = type;
            if(type === "ë¶ˆë¥œ") log(`ğŸ”¥ [ì†Œë¬¸] <b>${getN(id1)}</b>ì™€ <b>${getN(id2)}</b>ë‹˜ì´ ì‹¬ìƒì¹˜ ì•Šì•„ìš”!`, "log-scandal");
        }
    }

    function triggerEvent() {
        const evs = [
            {t: "ğŸŒˆ ì—”ì ¤ íˆ¬ììê°€ ìš°ë¦¬ íšŒì‚¬ë¥¼ ëˆˆì—¬ê²¨ë³´ê³  ìê¸ˆì„ ì§€ì›í–ˆìŠµë‹ˆë‹¤!", m: 1800000, c: "log-good"},
            {t: "ğŸ’§ ì„œë²„ì— ì»¤í”¼ë¥¼ ìŸì•„ ë³µêµ¬ ë¹„ìš©ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", m: -400000, c: "log-bad"},
            {t: "ğŸ­ ì‚¬ë‚´ ìŠ¤ìº”ë“¤ì´ ì¼íŒŒë§ŒíŒŒ í¼ì ¸ ì‚¬ê¸°ê°€ ì €í•˜ë©ë‹ˆë‹¤.", m: -150000, c: "log-scandal"}
        ];
        const ev = evs[Math.floor(Math.random()*evs.length)];
        st.m += ev.m; log(`ğŸ“¢ <b>[ì•Œë¦¼]</b> ${ev.t}`, ev.c);
    }

    function updateUI() {
        document.getElementById('mDisp').innerText = `ğŸ’° ${Math.floor(st.m).toLocaleString()}ì›`;
        document.getElementById('dDisp').innerText = `ğŸ“… Day ${st.d}`;
        document.getElementById('loanTag').style.display = st.loan > 0 ? "inline" : "none";
        document.getElementById('eGrid').innerHTML = st.e.map(e => `
            <div class="card ${e.isFired?'fired':''}" onclick="opM(${e.id})">
                <span class="rank-label">${RANKS[e.rIdx]}</span>
                <input class="name-input" value="${e.n}" onchange="st.e.find(x=>x.id==${e.id}).n=this.value" onclick="event.stopPropagation()">
                <div style="font-size:0.75rem; color:#aaa;">#${e.trait} | ${e.club || 'ë¬´ì†Œì†'}</div>
                <div class="stat-grid">
                    ${drawStat('ğŸ› ï¸ ê¸°ìˆ ', e.tech, 'var(--primary)')}
                    ${drawStat('ğŸ¤ ì˜ì—…', e.sale, 'var(--secondary)')}
                    ${drawStat('ğŸ§  ë©˜íƒˆ', e.mtl, 'var(--accent)')}
                    ${drawStat('â¤ï¸ ì²´ë ¥', e.hp, 'var(--point)')}
                </div>
            </div>
        `).join('');
        let rH = "";
        for(let k in st.r) {
            const [i1, i2] = k.split('-');
            const e1 = st.e.find(e => e.id == i1); const e2 = st.e.find(e => e.id == i2);
            if(e1 && e2 && !e1.isFired && !e2.isFired) rH += `<div class="rel-box"><span><b>${e1.n}</b> & <b>${e2.n}</b></span><span style="color:var(--accent); font-weight:bold;">${st.r[k]}</span></div>`;
        }
        document.getElementById('rList').innerHTML = rH || "<p style='text-align:center; color:#ccc;'>ì•„ì§ ì•„ë¬´ ì¸ì—°ë„ ë§ºì–´ì§€ì§€ ì•Šì•˜ì–´ìš”.</p>";
        document.getElementById('cList').innerHTML = CLUBS.map(club => {
            const members = st.e.filter(e => e.club === club && !e.isFired).map(e => e.n);
            return members.length > 0 ? `<div style="padding:15px; background:white; border-radius:15px; margin-bottom:8px; font-size:0.9rem; border:1px solid #f9f9f9;"><b>${club}:</b> ${members.join(', ')}</div>` : '';
        }).join('');
    }

    function drawStat(label, val, col) { return `<div class="stat-item">${label}<div class="bar-bg"><div class="bar-fill" style="width:${Math.min(val,100)}%; background:${col}"></div></div></div>`; }
    function log(m, c="") {
        const lBox = document.getElementById('lBox');
        const d = document.createElement('div');
        d.className = `log-item ${c}`;
        d.innerHTML = `<span class="log-time">Day ${st.d}</span>${m}`;
        lBox.appendChild(d); lBox.scrollTop = lBox.scrollHeight;
    }
    function opM(id) {
        const e = st.e.find(e => e.id === id); if(!e || e.isFired) return;
        selId = id; document.getElementById('editName').value = e.n;
        const others = st.e.filter(e => e.id !== id && !e.isFired);
        document.getElementById('relTarget').innerHTML = others.map(o => `<option value="${o.id}">${o.n}</option>`).join('');
        document.getElementById('btlTarget').innerHTML = others.map(o => `<option value="${o.id}">${o.n}</option>`).join('');
        document.getElementById('relType').innerHTML = REL_TYPES.map(r => `<option value="${r}">${r}</option>`).join('');
        document.getElementById('mOv').style.display = 'block';
    }
    function applyRel() {
        const tId = document.getElementById('relTarget').value; const type = document.getElementById('relType').value;
        if(tId) { st.r[[selId, tId].sort().join('-')] = type; log(`ğŸª„ <b>${getN(selId)}</b>ì™€ <b>${getN(tId)}</b>ì˜ ì¸ì—°ì„ <b>${type}</b>(ìœ¼)ë¡œ ë¬¶ì–´ì£¼ì—ˆìŠµë‹ˆë‹¤.`, "log-good"); clM(); updateUI(); }
    }
    function startBattle() {
        const p1 = st.e.find(e => e.id === selId); const p2 = st.e.find(e => e.id == document.getElementById('btlTarget').value);
        if(!p1 || !p2) return;
        if(p1.tech + p1.sale + Math.random()*50 > p2.tech + p2.sale + Math.random()*50) {
            p1.rIdx = Math.min(7, p1.rIdx + 1); p2.rIdx = Math.max(0, p2.rIdx - 1);
            log(`âš”ï¸ ë°°í‹€ ìŠ¹ë¦¬! <b>${p1.n}</b>ë‹˜ì´ ìŠ¹ì§„í•˜ê³  <b>${p2.n}</b>ë‹˜ì€ ê°•ë“±ë˜ì—ˆìŠµë‹ˆë‹¤.`, "log-good");
        } else { log(`âš”ï¸ ë°°í‹€ íŒ¨ë°°! <b>${p1.n}</b>ë‹˜ì˜ ë„ì „ì´ ì‹¤íŒ¨ë¡œ ëë‚¬ìŠµë‹ˆë‹¤.`, "log-bad"); }
        clM(); updateUI();
    }
    function takeLoan() { st.m += 2000000; st.loan += 2500000; log("ğŸ¦ ëŒ€ì¶œê¸ˆì´ ì…ê¸ˆë˜ì—ˆìŠµë‹ˆë‹¤. ì—´ì‹¬íˆ ê²½ì˜í•´ë³´ì•„ìš”!", "log-good"); updateUI(); }
    function manualFire() { const e = st.e.find(e => e.id === selId); if(e) { e.isFired = true; log(`âš ï¸ <b>${e.n}</b>ë‹˜ì´ íšŒì‚¬ë¥¼ ë– ë‚˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.`, "log-bad"); clM(); updateUI(); } }
    function checkEndings() {
        if(st.m < -5000000) { st.over = true; alert("íšŒì‚¬ê°€ íŒŒì‚°í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œì‘í•´ë³´ì„¸ìš”!"); location.reload(); }
        else if(st.m > 200000000) { st.over = true; alert("ì¶•í•˜í•©ë‹ˆë‹¤! ì—…ê³„ 1ìœ„ ê¸°ì—…ì´ ë˜ì—ˆìŠµë‹ˆë‹¤!"); location.reload(); }
    }
    function getN(id) { const e = st.e.find(x => x.id == id); return e ? e.n : "ëˆ„êµ°ê°€"; }
    function clM() { document.getElementById('mOv').style.display = 'none'; }
    function tab(t) { document.querySelectorAll('.page, .nav button').forEach(x => x.classList.remove('active')); document.getElementById(`p-${t}`).classList.add('active'); document.getElementById(`n-${t}`).classList.add('active'); }
    function toggleAuto() { if(autoTimer) { clearInterval(autoTimer); autoTimer = null; document.getElementById('autoBtn').innerText = "ìë™ ì‹œì‘"; } else { autoTimer = setInterval(nextDay, 1000); document.getElementById('autoBtn').innerText = "ì¤‘ì§€"; } }
    function saveData(t) { const d = t==='HR'?st.e:st; const b = new Blob([JSON.stringify(d)], {type:'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = `${t}_DATA.json`; a.click(); }
    updateUI();
</script>
</body>
</html>
